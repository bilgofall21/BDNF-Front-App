<app-header></app-header>

<div class="container py-5">
  <div class="row align-items-center shadow-lg border-0 rounded-3 overflow-hidden bg-white p-4">
    @if (loadingData) {
    <app-spinner></app-spinner>
    }
    @else if (dataRealisationData) {
      <!-- background: 'linear-gradient(135deg, #a12825 0%, #d9442c 100%)' -->

    <!-- Section Image/PDF -->
    <div class="col-md-6 p-0">
      @if (isPdf(dataRealisationData)) {
      <!-- Affichage pour les PDFs -->
      <div class="pdf-detail-container position-relative" style="background: linear-gradient(135deg, #a12825 0%, #d9442c 100%);
                      height: 450px;
                      border-radius: 10px;
                      display: flex;
                      flex-direction: column;
                      align-items: center;
                      justify-content: center;
                      color: white;">

        <div class="text-center p-4">
          <i class="bi bi-file-pdf-fill" style="font-size: 6rem; opacity: 0.9;"></i>
          <h4 class="mt-3 mb-4">Document PDF</h4>
          <p class="mb-4">Consultez ce document au format PDF</p>

          <!-- Boutons d'action -->
          <div class="d-flex gap-3 justify-content-center flex-wrap">
            <button class="btn btn-light btn-lg shadow" (click)="openPdfViewer(dataRealisationData)">
              <i class="bi bi-eye me-2"></i>
              Visualiser
            </button>
            <button class="btn btn-outline-light btn-lg" (click)="openPdfInNewTab(dataRealisationData)">
              <i class="bi bi-box-arrow-up-right me-2"></i>
              Nouvel onglet
            </button>
            <button class="btn btn-success btn-lg shadow" (click)="downloadPdf(dataRealisationData)">
              <i class="bi bi-download me-2"></i>
              T√©l√©charger
            </button>
          </div>
        </div>

        <!-- Badge indicateur -->
        <span class="badge bg-danger position-absolute top-0 end-0 m-3 shadow fs-6">
          <i class="bi bi-file-earmark-pdf me-1"></i> Document PDF
        </span>
      </div>

      <!-- Pr√©visualisation iframe optionnelle -->
      <div class="mt-3 p-3 bg-light rounded">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            Pr√©visualisation du document
          </small>
          <button class="btn btn-sm btn-outline-secondary" (click)="togglePdfPreview()">
            <i class="bi" [ngClass]="showPdfPreview ? 'bi-eye-slash' : 'bi-eye'"></i>
          </button>
        </div>
        @if (showPdfPreview) {
        <iframe [src]="sanitizer.bypassSecurityTrustResourceUrl(getRealisationImage(dataRealisationData))" width="100%"
          height="300px" style="border: 1px solid #dee2e6; border-radius: 5px;" title="Pr√©visualisation PDF">
        </iframe>
        }
      </div>

      } @else {
      <!-- Affichage pour les images -->
      <img [src]="getRealisationImage(dataRealisationData)" class="img-fluid w-100 rounded-start"
        alt="{{dataRealisationData.titre}}" (error)="onImageError($event)" style="object-fit: cover;
                      height: 100%;
                      max-height: 450px;
                      transition: transform 0.3s ease-in-out;
                      border-radius: 10px;
                      cursor: zoom-in;" (click)="openImageModal()">
      }
    </div>

    <!-- Section Contenu -->
    <div class="col-md-6 p-5">
      <div class="mb-3">
        @if (isPdf(dataRealisationData)) {
        <span class="badge bg-danger me-2">
          <i class="bi bi-file-pdf me-1"></i> PDF
        </span>
        } @else {
        <span class="badge bg-primary me-2">
          <i class="bi bi-image me-1"></i> Image
        </span>
        }
        <span class="text-muted">
          <i class="bi bi-calendar3 me-1"></i>
          {{ dataRealisationData.created_at | dateFormat }}
        </span>
      </div>

      <h2 class="fw-bold text-center text-md-start mb-4">
        {{ dataRealisationData.titre }}
      </h2>

      <div class="text-muted text-justify overflow-auto mb-4" style="max-height: 400px;
                    font-size: 1.1rem;
                    line-height: 1.6;
                    padding-right: 10px;">
        <p>{{ dataRealisationData.description }}</p>
      </div>

      <!-- Actions suppl√©mentaires pour les PDFs -->
      @if (isPdf(dataRealisationData)) {
      <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-info-circle-fill me-3 fs-4"></i>
        <div>
          <strong>Document PDF disponible</strong>
          <p class="mb-0 small">
            Vous pouvez visualiser, t√©l√©charger ou ouvrir ce document dans un nouvel onglet.
          </p>
        </div>
      </div>
      }

      <div class="d-flex gap-3 flex-wrap text-center text-md-start mt-4">
        <button class="btn btn-primary px-4 py-2 shadow-sm" [routerLink]="['/realisation-user']">
          <i class="bi bi-arrow-left me-2"></i>
          Retour
        </button>

        @if (isPdf(dataRealisationData)) {
        <button class="btn btn-outline-primary px-4 py-2" (click)="openPdfViewer(dataRealisationData)">
          <i class="bi bi-eye me-2"></i>
          Voir le PDF
        </button>
        }
      </div>
    </div>

    } @else {
    <p class="text-center my-4">R√©alisation indisponible pour le moment üòí.</p>
    }
  </div>

  <!-- Section T√©moignages -->
  <div class="container mt-5">
    <h3 class="text-center mb-4 fw-bold">T√©moignages</h3>
    <div class="row row-gap-4 justify-content-center">
      @for (temoignage of lastTwoTemoignage; track temoignage) {
      <div class=" col-md-6">
        <div class="card commnet-container  p-4 shadow-sm">
          <p class="text-muted">{{temoignage.contenue}}</p>
          <h5 class="fw-bold">{{temoignage.nomClient}}</h5>
        </div>
      </div>
      }
    </div>
  </div>

  <!-- Section Contact -->
  <div class="container mb-2 text-center mt-5">
    <div class="row justify-content-center align-items-center mt-4 py-3"
      style="background: linear-gradient(135deg, #E7DCD6, #dddbda); border-radius: 15px;">
      <div class="col-md-4">
        <img src="assets/image/link2.png" class="img-fluid rounded shadow-sm" alt="Contactez-nous">
      </div>
      <div class="col-md-6">
        <h3 class="fw-bold">Contactez-nous</h3>
        <p class="text-muted my-4">Besoin d'une strat√©gie marketing efficace ? Parlons-en !</p>
        <a (click)="navigateToLinkeDin()" class="btn btn-primary px-4 py-2 shadow-sm mt-3">
          Visitez notre LinkedIn
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour visualiser les PDFs (m√™me que dans home) -->
<div class="modal fade" id="pdfViewerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">
          <i class="bi bi-file-pdf-fill text-danger me-2"></i>
          {{selectedPdfTitle}}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"
          (click)="closePdfViewer()"></button>
      </div>
      <div class="modal-body p-0" style="min-height: 600px;">
        @if (safePdfUrl) {
        <iframe [src]="safePdfUrl" width="100%" height="600px" style="border: none;" title="Visualisateur PDF">
        </iframe>
        }
      </div>
      <div class="modal-footer">
        <a [href]="currentPdfUrl" target="_blank" class="btn btn-primary">
          <i class="bi bi-box-arrow-up-right me-2"></i>
          Ouvrir dans un nouvel onglet
        </a>
        <a [href]="currentPdfUrl" download class="btn btn-success">
          <i class="bi bi-download me-2"></i>
          T√©l√©charger
        </a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="closePdfViewer()">
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour zoom image (optionnel) -->
<div class="modal fade" id="imageZoomModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content bg-transparent border-0">
      <div class="modal-body p-0 position-relative">
        <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3 z-index-1"
          data-bs-dismiss="modal" aria-label="Close" style="z-index: 10;"></button>
        @if (dataRealisationData && !isPdf(dataRealisationData)) {
        <img [src]="getRealisationImage(dataRealisationData)" class="img-fluid w-100"
          alt="{{dataRealisationData.titre}}" style="max-height: 90vh; object-fit: contain;">
        }
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
